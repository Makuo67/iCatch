<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/frontend/css/diagnosis.css">
</head>
<body>
    
    <div class="dashboard-container">

        <!-- Left Sidebar Navigation -->
        <div class="sidebar">
            <div class="logo">
                <img src="/images/Logo.png" alt="Logo">
            </div>
    
            <nav class="top-nav">
                <ul>
                    <li class="dashboard" id="dashboard"><a id="dashboard_label" href="/frontend/html/dashboard.html">Dashboard</a></li>
                    <li class="consultadoctor" id="consultadoctor"><a id="consultadoctor_label"
                            href="/frontend/html/consultdoctor.html">Consult a Doctor</a></li>
                    <li class="appointments" id="appointments"><a id="appointments_label"
                            href="/frontend/html/appointment.html">Appointments</a></li>
                    <li class="myhospital" id="myhospitals"><a id="myhospitals_label" href="/frontend/html/myhospitals.html">My
                            Hospitals</a></li>
                            <li class="myhospital" id="myhospitals"><a id="myhospitals_label" href="/frontend/html/diagnosis.html">AI Diagnosis</a></li>
                </ul>
            </nav>
            <nav class="bottom-nav">
                <ul>
                    <li><a href="#">Settings</a></li>
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Refer Family & Friends</a></li>
                </ul>
            </nav>
        </div>
    
    
    
        <!-- Right Dashboard Information -->
        <div class="main-content">

            <div class="top-bar">
                <div>
                    <input type="search" id="searchInput" placeholder="Search here..." aria-label="Search"> 
                </div>

                <div class="profile">
                    <img src="/images/profile.jpg" alt="Profile Picture">
                </div>
                <div>
                    <img src="/images/notification-icon.png" alt="Notifications" class="notification-icon">
                </div>    
            </div>

            <!-- Main AI Diagnosis Section -->
            
            <div class="container">
                <h1>Fundus Disease Diagnosis</h1>
                <input type="file" id="imageUpload" accept="image/*">
                <button id="uploadButton">Upload Image</button>
        
                <div id="loading" class="loading" style="display: none;">Loading...</div>
        
                <div id="result" class="result" style="display: none;">
                    <h2 id="prediction"></h2>
                    <div class="image-container">
                        <div>
                            <h3>Original Image</h3>
                            <img id="originalImage" src="" alt="Original Image">
                        </div>
                        <div>
                            <h3>GradCAM++ Image</h3>
                            <img id="gradcamImage" src="" alt="GradCAM++ Image">
                        </div>
                    </div>
                    <h3>AI Explanation:</h3>
                    <p id="explanation"></p>
                </div>
            </div>
        </div>  
    </div>
    <script>
        // Main AI Diagnosis FUnction
        document.addEventListener("DOMContentLoaded", () => {
  document
    .getElementById("uploadButton")
    .addEventListener("click", async () => {
      const fileInput = document.getElementById("imageUpload");
      const file = fileInput.files[0];
      if (!file) {
        alert("Please select an image file.");
        return;
      }

      // Show loading text
      document.getElementById("loading").style.display = "block";

      const formData = new FormData();
      formData.append("file", file);

      try {
        const response = await fetch("http://localhost:8000/predict/", {
          method: "POST",
          body: formData,
        });

        // Log response details for debugging
        console.log("Response Status:", response.status);
        console.log("Response Status Text:", response.statusText);
        console.log("Response Body:", await response.text());

        if (!response.ok) {
          const errorResponse = await response.json();
          console.error("Error Response:", errorResponse);
          throw new Error(`Error ${response.status}: ${errorResponse.message || "Upload failed"}`);
        }

        // Get response data directly
        const data = await response.json();
        displayResults(data); // Pass only the data to displayResults
      } catch (error) {
        console.error("Error uploading file:", error);
        alert("There was an error uploading the file: " + error.message);
      } finally {
        document.getElementById("loading").style.display = "none";
      }
    });

  function displayResults(data) {
    document.getElementById("prediction").innerText = `Diagnosis: ${data.prediction}`;
    document.getElementById("originalImage").src = data.original_image; // Use the URL for the original image
    document.getElementById("gradcamImage").src = data.gradcam_image; // Display the GradCAM++ image
    document.getElementById("explanation").innerText = data.explanation;

    document.getElementById("result").style.display = "block";
  }
});
</script>
</body>
</html>